---
phase: 05-rag-tracker-and-formula-sheets
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - foundation/formulas/index.html
  - core/formulas/index.html
  - additional/formulas/index.html
  - assets/css/styles.css
autonomous: true
requirements:
  - FORM-01
  - FORM-02
  - FORM-03
  - FORM-04

must_haves:
  truths:
    - "Pupil can navigate to /MathsRevisionSite/foundation/formulas/ and see a Foundation formula reference page"
    - "Pupil can navigate to /MathsRevisionSite/core/formulas/ and see a Core formula reference page"
    - "Pupil can navigate to /MathsRevisionSite/additional/formulas/ and see an Additional formula reference page"
    - "KaTeX formulas on all three pages render correctly (not raw LaTeX text)"
    - "Pupil can print any formula sheet from desktop — site nav, header, and breadcrumb do not appear in print output"
    - "Formula blocks do not split mid-formula across a page break when printing"
  artifacts:
    - path: "foundation/formulas/index.html"
      provides: "Foundation formula reference page with KaTeX-rendered formulas for mean, range, fractions, factor trees, long multiplication"
      contains: "formula-block"
    - path: "core/formulas/index.html"
      provides: "Core formula reference page with KaTeX formulas for percentage change, ratio, area/volume, nth term, speed/distance/time, y=mx+c"
      contains: "formula-block"
    - path: "additional/formulas/index.html"
      provides: "Additional formula reference page with KaTeX formulas for index laws (all 5 rules), FOIL, Pythagoras"
      contains: "formula-block"
    - path: "assets/css/styles.css"
      provides: "Print CSS: @page A4 size, hide .site-header/.breadcrumb/footer, break-inside:avoid on .formula-block; screen CSS for .formula-section and .formula-block"
      contains: "@page"
  key_links:
    - from: "foundation/formulas/index.html"
      to: "assets/css/styles.css"
      via: "link rel=stylesheet /MathsRevisionSite/assets/css/styles.css"
      pattern: "styles.css"
    - from: "foundation/formulas/index.html"
      to: "KaTeX CDN auto-render"
      via: "same defer + onload pattern as all topic pages"
      pattern: "auto-render.min.js"
    - from: "assets/css/styles.css @media print"
      to: ".formula-block"
      via: "break-inside: avoid"
      pattern: "break-inside"
---

<objective>
Create three formula reference HTML pages (Foundation, Core, Additional) with KaTeX-rendered formulas and print CSS, matching the existing site template.

Purpose: Pupils can open a single formula reference page per level before a practice exam, and print it cleanly on A4 from a desktop browser — no site navigation clutters the print output.

Output: foundation/formulas/index.html, core/formulas/index.html, additional/formulas/index.html (all new), plus print CSS and formula screen CSS added to assets/css/styles.css.
</objective>

<execution_context>
@/Users/josh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/josh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/josh/projects/maths-revision/.planning/PROJECT.md
@/Users/josh/projects/maths-revision/.planning/ROADMAP.md

<!-- Reference page to match the site template exactly -->
@/Users/josh/projects/maths-revision/foundation/fractions/index.html
@/Users/josh/projects/maths-revision/core/index.html
@/Users/josh/projects/maths-revision/assets/css/styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add formula screen and print CSS to styles.css</name>
  <files>
    assets/css/styles.css
  </files>
  <action>
Append to /Users/josh/projects/maths-revision/assets/css/styles.css. Add two clearly marked sections.

**Section 1 — Screen CSS** (labelled `/* ─── FORMULA SHEETS ─── */`):

```css
/* ─── FORMULA SHEETS ─── */
.formula-section {
  margin: 1.5rem 0;
}

.formula-section h2 {
  font-size: 1.15rem;
  font-weight: 700;
  color: var(--mh-navy);
  margin-bottom: 0.5rem;
  border-bottom: 2px solid var(--mh-navy);
  padding-bottom: 0.25rem;
}

.formula-block {
  background: var(--white, #fff);
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  padding: 0.75rem 1rem;
  margin: 0.5rem 0;
}

.formula-block p {
  margin: 0.2rem 0;
}

.formula-print-hint {
  font-size: 0.85rem;
  color: var(--text-muted, #64748b);
  margin-bottom: 1.25rem;
  padding: 0.5rem 0.75rem;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
}
```

**Section 2 — Print CSS** (inside an `@media print` block, labelled `/* ─── PRINT: FORMULA SHEETS ─── */`). Add this AFTER the existing `@media print { .rag-selector, .rag-unavailable { display: none !important; } }` block from plan 05-01, or create a new @media print block if 05-01 hasn't run yet (both will be correct — browsers merge @media print blocks):

```css
/* ─── PRINT: FORMULA SHEETS ─── */
@media print {
  @page {
    size: A4;
    margin: 1.5cm;
  }

  .site-header,
  .breadcrumb,
  footer,
  .formula-print-hint {
    display: none !important;
  }

  .formula-block {
    break-inside: avoid;
    page-break-inside: avoid; /* fallback for older Safari */
    border: 1px solid #ccc;
  }

  .formula-section h2 {
    break-after: avoid;
    page-break-after: avoid;
  }

  body {
    background: white;
    color: black;
  }

  .main-content {
    max-width: 100%;
    padding: 0;
  }
}
```

NOTE: If plan 05-01 already ran and added `@media print { .rag-selector, .rag-unavailable { display: none !important; } }`, do NOT create a duplicate wrapper — add the formula print rules into a single combined @media print block, or add a second @media print block (both are valid CSS). Do not remove the RAG print rules.
  </action>
  <verify>
    <automated>node -e "
const fs = require('fs');
const css = fs.readFileSync('/Users/josh/projects/maths-revision/assets/css/styles.css', 'utf8');
console.assert(css.includes('.formula-section'), '.formula-section missing');
console.assert(css.includes('.formula-block'), '.formula-block missing');
console.assert(css.includes('.formula-print-hint'), '.formula-print-hint missing');
console.assert(css.includes('@page'), '@page missing');
console.assert(css.includes('size: A4') || css.includes('size:A4'), 'A4 page size missing');
console.assert(css.includes('break-inside: avoid'), 'break-inside missing');
console.assert(css.includes('page-break-inside: avoid'), 'page-break-inside fallback missing');
console.assert(css.includes('break-after: avoid'), 'break-after missing');
console.log('Formula CSS assertions passed');
"</automated>
  </verify>
  <done>
    - .formula-section, .formula-block, .formula-print-hint screen CSS present in styles.css
    - @media print block contains @page { size: A4; margin: 1.5cm }, hides .site-header/.breadcrumb/footer/.formula-print-hint
    - .formula-block has break-inside: avoid AND page-break-inside: avoid (modern + legacy fallback)
    - .formula-section h2 has break-after: avoid
    - Existing RAG print hide rules from plan 05-01 are not removed
  </done>
</task>

<task type="auto">
  <name>Task 2: Create the three formula reference HTML pages</name>
  <files>
    foundation/formulas/index.html
    core/formulas/index.html
    additional/formulas/index.html
  </files>
  <action>
Create 3 new HTML files. Each must exactly match the site template (same head block, same site-header, same footer) as existing topic pages — use foundation/fractions/index.html as the reference template.

All 3 pages must use:
- Same KaTeX head block (defer scripts, same CDN URLs, same onload auto-render call with same delimiter order: $$ before $)
- `<link rel="stylesheet" href="/MathsRevisionSite/assets/css/styles.css">`
- Same site-header with nav (correct active class per level)
- Breadcrumb linking back to level index and Home
- level-badge with correct level class
- `<p class="formula-print-hint">Press Ctrl+P (or Cmd+P on Mac) to print this sheet. Wait for equations to appear before printing.</p>`
- Sections using `<section class="formula-section">` with `<h2>Topic Name</h2>` and `<div class="formula-block">` per formula

---

**foundation/formulas/index.html** — title: "Foundation Formula Sheet | Maths Revision | Mowden Hall"
Active nav link: Foundation. Level badge: `<span class="level-badge foundation">Foundation</span>`
Breadcrumb: Home › Foundation › Formula Sheet

Sections and formulas (use KaTeX $ delimiters inline, $$ for display equations):

Section: Averages
- Mean: $\text{Mean} = \dfrac{\text{Sum of values}}{\text{Number of values}}$
- Range: $\text{Range} = \text{Largest value} - \text{Smallest value}$

Section: Fractions
- Adding/subtracting: Find a common denominator first. $\dfrac{a}{c} + \dfrac{b}{c} = \dfrac{a+b}{c}$
- Multiplying: $\dfrac{a}{b} \times \dfrac{c}{d} = \dfrac{ac}{bd}$
- Dividing (KFC): $\dfrac{a}{b} \div \dfrac{c}{d} = \dfrac{a}{b} \times \dfrac{d}{c} = \dfrac{ad}{bc}$

Section: Prime Factors
- Every integer can be written as a product of prime factors. Use a factor tree to find them.
- Example: $24 = 2^3 \times 3$

Section: Estimation
- Round each number to 1 significant figure, then calculate.
- Example: $\dfrac{48.3 \times 9.7}{2.1} \approx \dfrac{50 \times 10}{2} = 250$

Section: Long Multiplication
- Partition the second number, multiply each part, then add.
- Example: $347 \times 23 = 347 \times 20 + 347 \times 3 = 6940 + 1041 = 7981$

---

**core/formulas/index.html** — title: "Core Formula Sheet | Maths Revision | Mowden Hall"
Active nav link: Core. Level badge: `<span class="level-badge core">Core</span>`
Breadcrumb: Home › Core › Formula Sheet

Sections and formulas:

Section: Percentages
- Percentage of amount: $\text{Amount} \times \dfrac{\text{Percentage}}{100}$
- Percentage change: $\dfrac{\text{New} - \text{Original}}{\text{Original}} \times 100$
- Percentage increase: $\text{Original} \times \left(1 + \dfrac{r}{100}\right)$
- Percentage decrease: $\text{Original} \times \left(1 - \dfrac{r}{100}\right)$

Section: Ratio
- To share in ratio $a : b$: total parts $= a + b$; each part $= \dfrac{\text{Total}}{a+b}$

Section: Algebra
- Collecting like terms: only combine terms with the same letter and power.
- Expanding brackets: $a(b + c) = ab + ac$
- Difference of two squares: $a^2 - b^2 = (a+b)(a-b)$

Section: Sequences (nth term)
- Linear nth term: $U_n = a + (n-1)d$ where $a$ = first term, $d$ = common difference
- Equivalent form: $U_n = dn + (a - d)$

Section: Straight Line Graphs
- Equation of a line: $y = mx + c$ where $m$ = gradient, $c$ = y-intercept
- Gradient: $m = \dfrac{y_2 - y_1}{x_2 - x_1}$

Section: Speed, Distance and Time
- $\text{Speed} = \dfrac{\text{Distance}}{\text{Time}}$ (SDT triangle: $S = D \div T$, $D = S \times T$, $T = D \div S$)

Section: Area and Volume
- Rectangle: $A = lw$
- Triangle: $A = \dfrac{1}{2}bh$
- Circle area: $A = \pi r^2$
- Circle circumference: $C = 2\pi r = \pi d$
- Cuboid volume: $V = lwh$
- Cylinder volume: $V = \pi r^2 h$

---

**additional/formulas/index.html** — title: "Additional Formula Sheet | Maths Revision | Mowden Hall"
Active nav link: Additional. Level badge: `<span class="level-badge additional">Additional</span>`
Breadcrumb: Home › Additional › Formula Sheet

Sections and formulas:

Section: Index Laws
- Multiplication: $a^m \times a^n = a^{m+n}$
- Division: $a^m \div a^n = a^{m-n}$
- Power of a power: $(a^m)^n = a^{mn}$
- Zero index: $a^0 = 1$ (for any $a \neq 0$)
- Negative index: $a^{-n} = \dfrac{1}{a^n}$

Section: Expanding and Factorising
- FOIL (double brackets): $(a+b)(c+d) = ac + ad + bc + bd$
- Factorising: find common factor, write outside bracket. Example: $6x^2 + 9x = 3x(2x + 3)$
- Difference of two squares: $a^2 - b^2 = (a+b)(a-b)$

Section: Pythagoras' Theorem
- For a right-angled triangle with hypotenuse $c$: $$a^2 + b^2 = c^2$$
- Finding hypotenuse: $c = \sqrt{a^2 + b^2}$
- Finding a shorter side: $a = \sqrt{c^2 - b^2}$

Each formula belongs in its own `<div class="formula-block"><p>...</p></div>` — one formula concept per block. Section headings use `<h2>` inside `<section class="formula-section">`.

The page structure should be:
```
<main class="main-content">
  <p class="breadcrumb">...</p>
  <span class="level-badge LEVEL">LEVEL</span>
  <h1 class="page-title">LEVEL Formula Sheet</h1>
  <p class="formula-print-hint">Press Ctrl+P (or Cmd+P on Mac) to print this sheet. Wait for equations to appear before printing.</p>
  <section class="formula-section">
    <h2>Section Name</h2>
    <div class="formula-block"><p>Formula text with KaTeX</p></div>
    ...
  </section>
  ...
</main>
```
  </action>
  <verify>
    <automated>node -e "
const fs = require('fs');
var errors = [];
var pages = [
  { file: 'foundation/formulas/index.html', level: 'foundation', badge: 'level-badge foundation', titleText: 'Foundation Formula Sheet' },
  { file: 'core/formulas/index.html', level: 'core', badge: 'level-badge core', titleText: 'Core Formula Sheet' },
  { file: 'additional/formulas/index.html', level: 'additional', badge: 'level-badge additional', titleText: 'Additional Formula Sheet' }
];
pages.forEach(function(p) {
  var path = '/Users/josh/projects/maths-revision/' + p.file;
  if (!fs.existsSync(path)) { errors.push(p.file + ': file does not exist'); return; }
  var html = fs.readFileSync(path, 'utf8');
  if (!html.includes('katex')) errors.push(p.file + ': missing KaTeX script');
  if (!html.includes('auto-render.min.js')) errors.push(p.file + ': missing auto-render script');
  if (!html.includes('styles.css')) errors.push(p.file + ': missing styles.css link');
  if (!html.includes(p.badge)) errors.push(p.file + ': missing level badge ' + p.badge);
  if (!html.includes('formula-block')) errors.push(p.file + ': missing formula-block');
  if (!html.includes('formula-section')) errors.push(p.file + ': missing formula-section');
  if (!html.includes('formula-print-hint')) errors.push(p.file + ': missing print hint');
  if (!html.includes('site-header')) errors.push(p.file + ': missing site-header');
  if (!html.includes('breadcrumb')) errors.push(p.file + ': missing breadcrumb');
});
if (errors.length) { errors.forEach(function(e) { console.error(e); }); process.exit(1); }
else console.log('All 3 formula pages verified');
"</automated>
    <manual>Open each formula page in a browser and confirm: KaTeX renders (no raw LaTeX visible after page loads), level badge colour matches the level, breadcrumb links work, print hint is visible. Trigger Ctrl+P and confirm nav/header are absent from the print preview.</manual>
  </verify>
  <done>
    - foundation/formulas/index.html, core/formulas/index.html, additional/formulas/index.html all exist
    - Each page has KaTeX head block (same defer + onload pattern as topic pages)
    - Each page has correct level-badge, breadcrumb, site-header with correct active nav link
    - Each page has formula-print-hint paragraph
    - Foundation page covers: Averages (mean, range), Fractions (add/subtract/multiply/divide), Prime Factors, Estimation, Long Multiplication
    - Core page covers: Percentages, Ratio, Algebra (expanding/factorising/DOTS), Sequences (nth term), Straight Line Graphs (y=mx+c, gradient), Speed/Distance/Time, Area and Volume
    - Additional page covers: Index Laws (all 5 rules), Expanding/Factorising (FOIL, factorising, DOTS), Pythagoras (theorem + finding sides)
    - FORM-01, FORM-02, FORM-03 satisfied
    - FORM-04 satisfied via @media print CSS in styles.css (A4, hide nav/header/footer, break-inside avoid on .formula-block)
  </done>
</task>

</tasks>

<verification>
All tasks complete when:
- CSS assertions in Task 1 verify pass (@page, break-inside, formula-block rules present)
- All 3 formula pages exist and pass Task 2 automated assertions
- Manual check: open any formula page in browser, confirm KaTeX renders, confirm print preview hides nav/header

Linked from level indexes (added in plan 05-01 Task 3). If 05-01 runs before 05-02, the formula links will already exist on the index pages pointing to these pages.
</verification>

<success_criteria>
- FORM-01: /MathsRevisionSite/foundation/formulas/ loads, shows Foundation formulas with KaTeX rendering
- FORM-02: /MathsRevisionSite/core/formulas/ loads, shows Core formulas with KaTeX rendering
- FORM-03: /MathsRevisionSite/additional/formulas/ loads, shows Additional formulas with KaTeX rendering
- FORM-04: Ctrl+P on any formula page shows clean A4 print preview with no nav/header/footer; formula blocks do not split mid-formula across pages
</success_criteria>

<output>
After completion, create `/Users/josh/projects/maths-revision/.planning/phases/05-rag-tracker-and-formula-sheets/05-02-SUMMARY.md`
</output>
