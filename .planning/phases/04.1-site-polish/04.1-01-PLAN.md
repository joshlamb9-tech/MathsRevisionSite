---
phase: 04.1-site-polish
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - assets/css/styles.css
  - additional/pythagoras/index.html
  - foundation/fractions/index.html
  - foundation/division/index.html
  - foundation/prime-factors/index.html
  - foundation/estimation/index.html
  - foundation/long-multiplication/index.html
  - foundation/averages/index.html
  - .planning/phases/04-additional-content/04-01-SUMMARY.md
  - .planning/phases/04-additional-content/04-02-SUMMARY.md
autonomous: true
requirements: [INFRA-04, DESIGN-04]

must_haves:
  truths:
    - "All 6 Foundation topic pages use class='non-calc-badge' on their badge element — no inline style= attribute for the badge"
    - "styles.css contains a .non-calc-badge rule with the green badge colours extracted from the Foundation pages"
    - "The Desmos toggle button on the Pythagoras page renders purple (#7c3aed / --additional-accent), not blue"
    - "04-01-SUMMARY.md frontmatter has a requirements-completed field listing ADD-01 and ADD-02"
    - "04-02-SUMMARY.md frontmatter has a requirements-completed field listing ADD-03 and GRAPH-04"
  artifacts:
    - path: "assets/css/styles.css"
      provides: ".non-calc-badge CSS class and .page-additional .desmos-toggle-btn override"
      contains: ".non-calc-badge"
    - path: "additional/pythagoras/index.html"
      provides: "body tag with class='page-additional' for CSS scoping"
      contains: "page-additional"
    - path: "foundation/fractions/index.html"
      provides: "Badge using class not inline style"
      contains: "non-calc-badge"
    - path: ".planning/phases/04-additional-content/04-01-SUMMARY.md"
      provides: "Standard frontmatter"
      contains: "requirements-completed"
    - path: ".planning/phases/04-additional-content/04-02-SUMMARY.md"
      provides: "Standard frontmatter"
      contains: "requirements-completed"
  key_links:
    - from: "foundation/*/index.html (all 6)"
      to: ".non-calc-badge CSS rule"
      via: "class attribute on <p> element"
      pattern: "class=\"non-calc-badge\""
    - from: "additional/pythagoras/index.html"
      to: ".page-additional .desmos-toggle-btn"
      via: "body class='page-additional'"
      pattern: "class=\"page-additional\""
---

<objective>
Extract the non-calculator badge inline styles into a .non-calc-badge CSS class, fix the Desmos toggle button colour on the Pythagoras page, and standardise Phase 4 SUMMARY frontmatter.

Purpose: CSS maintainability (badge change requires editing 1 file not 6), visual correctness (purple button on Additional page), and tooling compatibility (gsd summary-extract reads requirements-completed field).
Output: Updated styles.css, 6 updated Foundation HTML files, 1 updated Pythagoras HTML file, 2 updated SUMMARY.md files.
</objective>

<execution_context>
@/Users/josh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/josh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@assets/css/styles.css
@.planning/phases/04-additional-content/04-01-SUMMARY.md
@.planning/phases/04-additional-content/04-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract non-calc badge inline styles to CSS class and update all 6 Foundation pages</name>
  <files>
    assets/css/styles.css
    foundation/fractions/index.html
    foundation/division/index.html
    foundation/prime-factors/index.html
    foundation/estimation/index.html
    foundation/long-multiplication/index.html
    foundation/averages/index.html
  </files>
  <action>
    Step 1 — Add .non-calc-badge rule to assets/css/styles.css.

    Append the following rule in the "LEVEL BADGE" section, immediately after the `.level-badge.additional` rule block (around line 245). Add a blank line after the .level-badge.additional closing brace then insert:

    ```css
    /* ─── NON-CALCULATOR BADGE ─── */
    /* Used on all 6 Foundation topic pages (Paper 1 = non-calculator) */
    .non-calc-badge {
      display: inline-block;
      background: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #a5d6a7;
      border-radius: 4px;
      padding: 0.25rem 0.75rem;
      font-size: 0.85rem;
      font-weight: 600;
      margin: 0.5rem 0 1.5rem;
    }
    ```

    Step 2 — In all 6 Foundation topic pages, replace the inline-styled badge element with the classed version.

    Find (present on line 62 in fractions/division/prime-factors, line 61 in estimation/long-multiplication/averages):
    ```html
    <p style="display:inline-block;background:#e8f5e9;color:#2e7d32;border:1px solid #a5d6a7;border-radius:4px;padding:0.25rem 0.75rem;font-size:0.85rem;font-weight:600;margin:0.5rem 0 1.5rem;">Non-calculator &mdash; Paper 1</p>
    ```

    Replace with:
    ```html
    <p class="non-calc-badge">Non-calculator &mdash; Paper 1</p>
    ```

    Apply this replacement in all 6 files:
    - foundation/fractions/index.html
    - foundation/division/index.html
    - foundation/prime-factors/index.html
    - foundation/estimation/index.html
    - foundation/long-multiplication/index.html
    - foundation/averages/index.html

    Do NOT change any other content on these pages — breadcrumbs, nav, KaTeX, worked examples all remain unchanged.
  </action>
  <verify>
    <automated>grep -r "non-calc-badge" /Users/josh/projects/maths-revision/foundation/ | wc -l | xargs -I{} test {} -eq 6 && echo "PASS: all 6 Foundation pages use .non-calc-badge" || echo "FAIL: expected 6"; grep -c "style=" /Users/josh/projects/maths-revision/foundation/fractions/index.html | xargs -I{} test {} -eq 0 && echo "PASS: no inline style on fractions badge" || echo "FAIL: inline style remains"; grep "\.non-calc-badge" /Users/josh/projects/maths-revision/assets/css/styles.css && echo "PASS: CSS class exists" || echo "FAIL: CSS class missing"</automated>
    <manual>Optionally open one Foundation page in a browser and confirm the badge still shows green with "Non-calculator — Paper 1" text</manual>
  </verify>
  <done>
    All 6 Foundation pages have `class="non-calc-badge"` on the badge element (no style= attribute). styles.css contains the .non-calc-badge rule with the green badge colours. Zero inline style attributes remain on badge elements across all 6 Foundation pages.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Desmos toggle button colour on Pythagoras page (purple not blue)</name>
  <files>
    additional/pythagoras/index.html
    assets/css/styles.css
  </files>
  <action>
    The problem: `.desmos-toggle-btn { background: var(--core-accent) }` in styles.css is global and makes the button blue (#2563eb) on the Pythagoras (Additional) page. The button should be purple (#7c3aed / --additional-accent) to match the Additional level brand.

    Fix approach: Add a class `page-additional` to the `<body>` tag on the Pythagoras page, then add a scoped CSS override in styles.css.

    Step 1 — In additional/pythagoras/index.html, find:
    ```html
    <body>
    ```
    Replace with:
    ```html
    <body class="page-additional">
    ```
    (This is the only change needed to the Pythagoras HTML — do not touch breadcrumb, nav, content, Desmos JS, or any other element.)

    Step 2 — In assets/css/styles.css, append the following at the very end of the file (after the existing `.desmos-toggle-btn` responsive block that ends around line 356):

    ```css

    /* ─── ADDITIONAL LEVEL OVERRIDES ─── */
    /* Scope Desmos toggle button to purple on Additional pages.
       Core pages use .desmos-toggle-btn { background: var(--core-accent) } (blue).
       Additional pages use .page-additional class on <body> to override. */
    .page-additional .desmos-toggle-btn {
      background: var(--additional-accent);
    }
    ```

    Do NOT modify the existing `.desmos-toggle-btn` rule — only add the scoped override.
  </action>
  <verify>
    <automated>grep "page-additional" /Users/josh/projects/maths-revision/additional/pythagoras/index.html && echo "PASS: body has page-additional class" || echo "FAIL: class missing"; grep "page-additional.*desmos-toggle-btn" /Users/josh/projects/maths-revision/assets/css/styles.css && echo "PASS: CSS override exists" || echo "FAIL: override missing"; grep "additional-accent" /Users/josh/projects/maths-revision/assets/css/styles.css | grep "desmos-toggle" && echo "PASS: additional-accent used" || echo "FAIL: accent not referenced"</automated>
    <manual>Optional: Open additional/pythagoras/index.html in a browser at mobile width (below 900px) — the "Tap to interact with graph" toggle button should appear purple, not blue.</manual>
  </verify>
  <done>
    additional/pythagoras/index.html has `class="page-additional"` on its body tag. styles.css contains `.page-additional .desmos-toggle-btn { background: var(--additional-accent); }` after the existing Desmos section. The existing `.desmos-toggle-btn` rule (blue) is unchanged — the override only applies when `.page-additional` is present.
  </done>
</task>

<task type="auto">
  <name>Task 3: Standardise Phase 4 SUMMARY frontmatter to use requirements-completed field</name>
  <files>
    .planning/phases/04-additional-content/04-01-SUMMARY.md
    .planning/phases/04-additional-content/04-02-SUMMARY.md
  </files>
  <action>
    Both Phase 4 SUMMARY files use non-standard frontmatter that gsd summary-extract cannot parse. Fix each file's YAML frontmatter only — do not change the body/prose below the closing `---`.

    For 04-01-SUMMARY.md:
    - Find the line: `provides: [ADD-01, ADD-02]`
    - Replace with: `requirements-completed: [ADD-01, ADD-02]`
    - Remove the line `affects: [additional/index-laws/index.html, additional/expanding-factorising/index.html]` (this is a file-affects field, not a requirements field — the key_files section already captures this)
    - Leave all other frontmatter fields untouched

    For 04-02-SUMMARY.md:
    - The frontmatter uses a multi-line `provides:` block with bullet points under `dependency-graph:`. This is inconsistent formatting.
    - Replace the entire frontmatter block (between the opening `---` and closing `---`) with the standardised version below. Keep the body (everything after the closing `---`) unchanged.

    Standardised 04-02-SUMMARY.md frontmatter:
    ```yaml
    ---
    phase: 04-additional-content
    plan: "02"
    subsystem: additional-content
    tags: [pythagoras, desmos, katex, interactive-graph, additional-level]
    one-liner: "Pythagoras topic page with KaTeX worked examples (6-8-10 hypotenuse, 5-12-13 shorter side) and Desmos right-triangle graph with a/b sliders and mobile scroll fix"
    dependency-graph:
      requires:
        - 04-01 (additional stubs and Additional index — provides page shell)
        - Phase 3 Desmos CSS pattern (desmos-wrapper, overlay, toggle button in styles.css)
    key-files:
      created: []
      modified:
        - additional/pythagoras/index.html
    decisions:
      - "[04-02]: desmos-wrapper-pyth ID used — scoped, consistent with desmos-wrapper-slg and desmos-wrapper-trans pattern from Phase 3"
      - "[04-02]: Default a=3, b=4 — 3-4-5 triple loads immediately so pupils see c=5 without needing to adjust sliders"
      - "[04-02]: Purple (#7c3aed) used for Desmos hypotenuse and triangle — matches Additional level brand colour"
    requirements-completed: [ADD-03, GRAPH-04]
    metrics:
      duration: "1 min"
      completed: "2026-02-27"
      tasks-completed: 1
      tasks-total: 1
      files-modified: 1
    ---
    ```

    Important: Keep everything after the closing `---` line in 04-02-SUMMARY.md exactly as-is (the `# Phase 4 Plan 2: Pythagoras Page Summary` section and all body content below it).
  </action>
  <verify>
    <automated>grep "requirements-completed" /Users/josh/projects/maths-revision/.planning/phases/04-additional-content/04-01-SUMMARY.md && echo "PASS: 04-01 has requirements-completed" || echo "FAIL"; grep "requirements-completed" /Users/josh/projects/maths-revision/.planning/phases/04-additional-content/04-02-SUMMARY.md && echo "PASS: 04-02 has requirements-completed" || echo "FAIL"; grep -c "provides:" /Users/josh/projects/maths-revision/.planning/phases/04-additional-content/04-01-SUMMARY.md | xargs -I{} test {} -eq 0 && echo "PASS: old provides field removed from 04-01" || echo "WARNING: provides still present"</automated>
  </verify>
  <done>
    Both 04-01-SUMMARY.md and 04-02-SUMMARY.md have `requirements-completed: [...]` in their YAML frontmatter. 04-01 lists [ADD-01, ADD-02]. 04-02 lists [ADD-03, GRAPH-04]. The body prose of both files is unchanged.
  </done>
</task>

</tasks>

<verification>
Run all three verify commands from the task blocks. All should return PASS.

Final check:
```bash
grep -r "non-calc-badge" /Users/josh/projects/maths-revision/foundation/ | wc -l
```
Must return 6.

```bash
grep "style=" /Users/josh/projects/maths-revision/foundation/*/index.html | grep "Non-calculator"
```
Must return zero lines (all inline badge styles removed).

```bash
grep "page-additional" /Users/josh/projects/maths-revision/additional/pythagoras/index.html
grep "\.page-additional .desmos-toggle-btn" /Users/josh/projects/maths-revision/assets/css/styles.css
grep "requirements-completed" /Users/josh/projects/maths-revision/.planning/phases/04-additional-content/04-01-SUMMARY.md
grep "requirements-completed" /Users/josh/projects/maths-revision/.planning/phases/04-additional-content/04-02-SUMMARY.md
```
All four must return matches.
</verification>

<success_criteria>
1. styles.css contains .non-calc-badge rule with background: #e8f5e9, color: #2e7d32, border: 1px solid #a5d6a7 values
2. All 6 Foundation pages use class="non-calc-badge" — zero inline style= attributes on badge elements
3. styles.css contains .page-additional .desmos-toggle-btn { background: var(--additional-accent); }
4. additional/pythagoras/index.html has class="page-additional" on its body tag
5. 04-01-SUMMARY.md frontmatter contains requirements-completed: [ADD-01, ADD-02]
6. 04-02-SUMMARY.md frontmatter contains requirements-completed: [ADD-03, GRAPH-04]
</success_criteria>

<output>
After completion, create `.planning/phases/04.1-site-polish/04.1-01-SUMMARY.md`
</output>
